# AI Translator (single-file web app)

## 对“代码简化建议”的负责人评审结论

整体判断：**方向正确，建议分层落地**。对当前项目（单文件 `translate.html`）来说，优先级建议如下：

1. **高优先级（立即做）**
   - 提取重复的请求逻辑（统一 API 请求入口、统一 header/body 生成）。
   - 复用模态框显隐逻辑（避免多个位置手写 class add/remove）。
   - 对按钮组采用事件委托（降低绑定数量，便于后续动态按钮扩展）。

2. **中优先级（下一迭代）**
   - 整理主题相关样式：把主题差异限制在 CSS 变量层，减少主题块里的重复结构样式。
   - 将内联样式（如 setup 引导区）替换为语义化 class，便于维护与复用。

3. **中长期（结构演进）**
   - 将脚本拆分成模块（ui/state/api/theme），逐步摆脱单文件复杂度。
   - 增加最小回归脚本（例如 Playwright 冒烟）保障重构安全。

## 本次已落地的改进

- 已将 API 请求封装为 `requestChatCompletion`，减少翻译/对话模式中的重复 fetch 配置。
- 已将模态框显隐统一为 `setModalVisibility`。
- 已将主题切换按钮与语言按钮切换改为事件委托。

## 设计建议（给下一位维护者）

- 单文件形态适合快速迭代，但功能继续增长时请优先控制**耦合度**与**职责边界**。
- 优先抽“重复流程”（请求、状态切换、UI 显示策略），再抽“纯样式重复”，收益更稳定。
- 任何重构都应优先保证用户路径：输入 -> 请求 -> 流式输出 -> 复制结果。
